name: Build all Docker images
on:
  schedule:
    - cron: '0 0 * * 4' # Every Thursday at midnight UTC
  repository_dispatch:
  workflow_dispatch:

env:
  FORCE_COLOR: 1

concurrency:
  group: release-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  basic:
    name: Build versatiles
    uses: ./.github/workflows/build-image.yml
    secrets: inherit
    with:
      name: versatiles

  rest:
    needs: basic
    name: Build rest
    secrets: inherit
    strategy:
      max-parallel: 1
      matrix:
        image: [frontend, nginx, tippecanoe, tilemaker]
    uses: ./.github/workflows/build-image.yml
    with:
      name: versatiles-${{ matrix.image }}