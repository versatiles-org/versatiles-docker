name: Build all Docker images
on:
  repository_dispatch:
    inputs:
      run_jobs:
        default: "all"
  workflow_dispatch:
    inputs:
      run_jobs:
        description: "Run which image build process?"
        default: "all"
        type: choice
        options:
          - all
          - basic
          - frontend
          - tilemaker
          - tippecanoe

env:
  FORCE_COLOR: 1

jobs:
  basic:
    name: Basic
    if: contains( fromJSON('["all", "basic"]'), github.event.inputs.run_jobs )
    uses: ./.github/workflows/build-image.yml
    secrets: inherit
    with:
      name: basic

  frontend:
    name: Frontend
    needs: basic
    if: contains( fromJSON('["all", "frontend"]'), github.event.inputs.run_jobs )
    uses: ./.github/workflows/build-image.yml
    secrets: inherit
    with:
      name: frontend

  tilemaker:
    name: tilemaker
    needs: basic
    if: contains( fromJSON('["all", "tilemaker"]'), github.event.inputs.run_jobs )
    uses: ./.github/workflows/build-image.yml
    secrets: inherit
    with:
      name: tilemaker

  tippecanoe:
    name: tippecanoe
    needs: basic
    if: contains( fromJSON('["all", "tippecanoe"]'), github.event.inputs.run_jobs )
    uses: ./.github/workflows/build-image.yml
    secrets: inherit
    with:
      name: tippecanoe
